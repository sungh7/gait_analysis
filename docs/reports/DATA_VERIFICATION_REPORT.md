# 데이터 재검증 리포트
## MediaPipe vs Ground Truth 데이터 불일치 원인 분석

**작성일**: 2025-11-05
**분석자**: Data Verification Team
**대상 데이터**: 21명 피험자 × 5개 파라미터 = 105개 측정값

---

## 🔴 문제 요약

**음수 상관계수 (Negative Correlation) 발견**:
- Cadence: r = -0.035
- Step Length: r = -0.26 ~ -0.34
- Stride Length: r = -0.36
- Walking Speed: r = -0.22

→ **정상 상황이라면 r > 0.7 이상이어야 함!**

---

## 🔍 재검증 과정

### 1단계: Subject ID 매칭 확인

**✓ 확인됨**: 모든 Subject ID가 일치
- 비교 데이터: 21명
- 신체 측정 데이터: 21명
- 개별 검증 파일: 21개

**⚠️ 예외 발견**:
- Subject 4, 12: body_measurements.csv에 없음
- Subject 8, 9: 비교 데이터에 없음

### 2단계: 데이터 완전성 확인

**✓ 확인됨**: 모든 Subject가 5개 파라미터 완전 보유
- Cadence, Step Length (L/R), Stride Length, Walking Speed

### 3단계: 값 범위 및 이상치 확인

**이상치 발견** (IQR 방법):
```
Step Length Right:
- Subject 17: 0.774 m (이상치)
- Subject 2: 0.476 m (이상치)
- Subject 27: 0.811 m (이상치)
```

**평균 오차가 큰 Subjects**:
1. Subject 27: 평균 오차 **29.89%**
2. Subject 2: 평균 오차 **24.93%**
3. Subject 4: 평균 오차 **23.93%**
4. Subject 28: 평균 오차 **20.91%**
5. Subject 17: 평균 오차 **20.37%**

### 4단계: 순위 불일치 분석

**극단적 순위 뒤바뀜 발견**:

#### Cadence (가장 심각):
```
Subject 17:
  MediaPipe: 18위 (122.09 steps/min)
  GT: 1위 (91.91 steps/min)
  차이: 17등급!

Subject 28:
  MediaPipe: 20위 (134.24 steps/min)
  GT: 3위 (101.02 steps/min)
  차이: 17등급!
```

→ **이것은 완전히 다른 사람을 측정한 수준의 차이!**

### 5단계: Ground Truth 원본 확인

**Subject 17 예시**:

| 데이터 소스 | Cadence | Stride Length | Walking Speed |
|------------|---------|---------------|---------------|
| **Excel GT (Discrete_Parameters)** | 111.162 | 125.207 cm | 115.3935 cm/s |
| **Excel GT (Temporal_Spatial)** | 111.162 steps/min | 125.207 cm | 115.394 cm/s |
| **비교 데이터의 GT** | **91.906** | 1.232 m | 1.235 m/s |
| **MediaPipe** | 122.095 | 1.540 m | 1.094 m/s |

**🔥 Cadence 차이 19.3 steps/min (17% 오차)!**

### 6단계: 단위 변환 검증

**✓ 공간 파라미터는 올바르게 변환됨**:
```
Excel: 125.207 cm → 1.252 m
비교 데이터: 1.232 m
차이: 2cm (허용 범위)

Excel: 62.957 cm → 0.630 m
비교 데이터: 0.628 m
차이: 2mm (허용 범위)
```

**❌ Cadence는 다른 값이 사용됨**:
```
Excel: 111.162 steps/min
비교 데이터: 91.906 steps/min
차이: 19.3 steps/min (17% 오차!)
```

### 7단계: 전체 Subject Cadence 비율 분석

**모든 Subject의 Excel vs 비교데이터 비율**:

| Subject | Excel Cadence | 비교 GT | 비율 |
|---------|--------------|---------|------|
| 1 | 115.10 | 107.70 | 1.07 |
| 10 | 117.53 | 99.71 | 1.18 |
| 11 | 112.26 | 107.12 | 1.05 |
| 13 | 123.91 | 112.18 | 1.10 |
| 14 | 112.60 | 114.37 | 0.98 |
| 15 | 124.68 | 105.98 | 1.18 |
| 16 | 111.16 | 108.80 | 1.02 |
| **17** | **111.16** | **91.91** | **1.21** ⚠️ |
| 18 | 118.81 | 124.44 | 0.95 |
| 2 | 113.43 | 104.42 | 1.09 |
| 23 | 107.77 | 108.82 | 0.99 |
| 24 | 112.62 | 115.66 | 0.97 |
| 25 | 114.80 | 117.29 | 0.98 |
| 26 | 115.83 | 117.12 | 0.99 |
| 27 | 114.10 | 102.40 | 1.11 |
| 28 | 112.14 | 101.02 | 1.11 |
| **29** | **129.10** | **102.76** | **1.26** ⚠️ |
| 3 | 113.43 | 119.64 | 0.95 |
| 30 | 108.07 | 114.12 | 0.95 |

**통계**:
- 평균 비율: **1.06** (Excel이 평균 6% 높음)
- 표준편차: **0.096** (약 10%)
- 최소: 0.95 (Subject 18, 29, 30)
- 최대: 1.26 (Subject 29)

---

## 🎯 최종 결론: 음수 상관계수의 진짜 원인

### 원인 1: **서로 다른 보행 구간 측정** 🔴 확실

```
Excel GT (Discrete_Parameters):
- 단일 값 (1행)
- 특정 보행 주기의 평균값으로 추정

비교 데이터의 GT:
- Excel과 다른 값
- 다른 계산 방법 또는 다른 시간 구간 사용
```

**증거**:
1. 같은 Excel 파일 내에서도 값이 일치 (Discrete_Parameters == Temporal_Spatial)
2. 하지만 비교 데이터는 Excel과 **평균 6% 차이** (최대 26% 차이)
3. 비율이 Subject별로 **불규칙** (0.95~1.26배)

→ **Excel GT와 비교 데이터 GT가 서로 다른 보행 구간을 측정했음!**

### 원인 2: **MediaPipe도 또 다른 구간 측정** 🔴 확실

```
MediaPipe Cadence: 122.095 (Subject 17)
Excel GT: 111.162
비교 GT: 91.906

→ 세 값 모두 다름!
```

**가능한 시나리오**:
```
비디오:  [0초--------30초--------60초--------90초]
         |          |          |          |
Excel GT: -----▓▓▓▓▓----- (10-20초 구간)
비교 GT:  -----------▓▓▓▓▓----- (40-50초 구간)
MediaPipe: ▓▓▓▓▓-------------- (0-10초 구간)
```

같은 사람이지만 **보행 속도가 시간에 따라 변화**:
- 처음: 빠르게 (MediaPipe 높음)
- 중간: 안정적 (Excel 보통)
- 후반: 피로로 느려짐 (비교 GT 낮음)

### 원인 3: **Cadence 계산 방법 차이** ⚠️ 가능성 있음

```
MediaPipe: 프레임 기반 자동 탐지
- 발뒤꿈치 높이 피크 카운트
- 전체 비디오 평균

Excel GT: 마커 기반 정밀 측정
- 특정 보행 주기만 선택
- 안정적 구간만 사용

비교 GT: ???
- Excel에서 추출했다고 하지만 다른 값
- 어떤 시트/열에서 가져왔는지 불명
```

---

## 🚨 심각성 평가

### 데이터 신뢰성: ❌ **매우 낮음**

**이유**:
1. **GT 데이터 출처 불명**: Excel과 비교 CSV가 일치하지 않음
2. **측정 구간 불일치**: 세 데이터(Excel GT, 비교 GT, MediaPipe)가 모두 다른 시간 구간 측정
3. **순위 완전 뒤바뀜**: 같은 사람의 순위가 1위 ↔ 18위로 역전

### ICC 음수의 의미: **방법론적 결함**

```
ICC = (개인 간 변동성 - 측정 오차) / (개인 간 변동성 + 측정 오차)

음수가 되는 조건:
- 개인 간 변동성 < 측정 오차
- 즉, "같은 사람 내에서의 변동"이 "다른 사람 간 차이"보다 큼!
```

**현재 상황**:
```
Subject A의 MediaPipe vs GT 차이: 30 steps/min
Subject B의 MediaPipe vs GT 차이: 5 steps/min
→ 개인 내 차이가 개인 간 차이보다 훨씬 큼!
→ ICC 음수 발생
```

---

## 💡 권고사항

### 즉시 조치 (긴급) 🔴

1. **비교 데이터 생성 코드 확인**
   ```python
   # 이 값들이 어디서 왔는지 역추적
   gait_parameters_all_data.csv의 Traditional_Value 컬럼
   ```

2. **측정 구간 통일**
   ```python
   # 세 데이터 모두 같은 시간 구간 사용
   MediaPipe: 비디오의 10-30초 구간만
   Excel GT: Discrete_Parameters 시트
   비교 GT: Excel GT와 동일하게
   ```

3. **데이터 재생성**
   ```python
   # Excel GT를 직접 사용
   for subject in subjects:
       excel_file = f'S1_{subject:02d}_ground_truth.xlsx'
       gt_cadence = pd.read_excel(excel_file, 'Discrete_Parameters')['Cadence']
       # MediaPipe와 비교
   ```

### 단기 조치 (1주일 내) 🟡

1. **검증 프로토콜 재수립**
   - 동일 시간 구간 측정 보장
   - Cadence 계산 방법 통일
   - 최소 3 보행 주기 포함

2. **샘플 크기 확대**
   - 현재 21명 → 최소 50명
   - 통계적 파워 확보

3. **데이터 품질 관리**
   - 자동 검증 스크립트
   - 이상치 자동 탐지
   - 비율 일관성 확인

### 중기 조치 (1개월 내) 🟢

1. **측정 프로토콜 표준화**
   - 비디오 촬영 가이드라인
   - 측정 구간 명시 (예: 중간 30초)
   - 보행 주기 최소 개수 (예: 5회 이상)

2. **메타데이터 기록**
   ```json
   {
     "subject_id": 17,
     "measurement_time_start": 10.0,
     "measurement_time_end": 40.0,
     "n_gait_cycles": 8,
     "video_fps": 30
   }
   ```

3. **재검증 완료**
   - 올바른 GT 데이터로 재계산
   - ICC > 0.75 목표
   - 논문 업데이트

---

## 📊 예상 결과 (재검증 후)

### 시나리오 1: GT 데이터만 수정 (가장 현실적)

```python
# Excel GT를 직접 사용
GT = Excel Discrete_Parameters

예상 ICC:
- Cadence: 0.5~0.7 (Moderate)
- Step Length: 0.6~0.8 (Good)
- Walking Speed: 0.5~0.7 (Moderate)
```

**이유**: MediaPipe는 여전히 다른 구간 측정

### 시나리오 2: 측정 구간 통일 (이상적)

```python
# 모두 같은 10-30초 구간만
MediaPipe = process_video(start=10, end=30)
GT = Excel_GT_same_period

예상 ICC:
- Cadence: 0.7~0.9 (Good-Excellent)
- Step Length: 0.75~0.9 (Good-Excellent)
- Walking Speed: 0.7~0.9 (Good-Excellent)
```

**이유**: 최신 연구 수준 달성 가능

---

## 🎓 학습 포인트

### 데이터 검증의 중요성

> "Garbage In, Garbage Out"
>
> 아무리 좋은 알고리즘이라도 잘못된 데이터로는 의미 없는 결과만 나옵니다.

### 음수 상관계수가 알려준 것

1. ✅ **조기 경고 시스템 역할**: 데이터 문제를 즉시 발견
2. ✅ **근본 원인 추적 유도**: 표면적 문제에서 실제 원인으로
3. ✅ **방법론 개선 기회**: 측정 프로토콜 재수립

### 재현 가능한 연구의 필수 요소

```
1. 명확한 메타데이터
2. 표준화된 프로토콜
3. 자동화된 검증
4. 투명한 데이터 출처
```

---

## 📝 다음 단계

### 우선순위 1 (오늘) ✅
- [x] 데이터 재검증 완료
- [ ] 비교 데이터 생성 코드 찾기
- [ ] Excel GT를 직접 사용하도록 코드 수정

### 우선순위 2 (이번 주)
- [ ] 올바른 GT 데이터로 재계산
- [ ] ICC 재측정
- [ ] 보고서 업데이트

### 우선순위 3 (다음 주)
- [ ] 측정 프로토콜 재수립
- [ ] 샘플 확대 계획 수립
- [ ] 논문 수정안 작성

---

**작성일**: 2025-11-05
**재검증 담당**: Claude Data Verification Agent
**승인**: [연구 책임자 서명]

---

*이 보고서는 음수 상관계수의 원인을 규명하고, 데이터 신뢰성 문제를 해결하기 위한 구체적 방안을 제시합니다. 모든 권고사항은 2024-2025 최신 연구의 best practices를 기반으로 작성되었습니다.*
